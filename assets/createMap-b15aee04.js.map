{"version":3,"file":"createMap-b15aee04.js","sources":["../../src/lib/label-editor/labelsStorage.js","../../src/lib/label-editor/createDOMMarkerEditor.js","../../src/lib/label-editor/createLabelEditor.js","../../src/lib/createMap.js"],"sourcesContent":["import config from '../config'\nimport generateShortRandomId from '../generateShortRandomId';\nimport bus from '../bus';\n\nlet originalPlaces;\nlet indexedPlaces = new Map();\n\nexport async function getPlaceLabels() {\n  let r = await fetch(config.placesSource, {mode: 'cors'})\n  originalPlaces = await r.json();\n  originalPlaces.features.forEach(f => {\n    indexedPlaces.set(f.properties.labelId, f);\n  });\n\n  const mergedLabels = mergePlacesWithLocalStorage(originalPlaces);\n  const hasChanges = checkOriginalPlacesForChanges(mergedLabels);\n  if (hasChanges) {\n    bus.fire('unsaved-changes-detected', hasChanges);\n  }\n  return mergedLabels;\n}\n\nfunction savePlaceLabels(places) {\n  localStorage.setItem('places', JSON.stringify(places));\n}\n\nexport function addLabelToPlaces(places, value, lngLat, mapZoomLevel, borderOwnerId) {\n  let labelId = generateShortRandomId();\n  while (indexedPlaces.has(labelId)) labelId = generateShortRandomId();\n\n  const label = {\n    type: 'Feature',\n    geometry: {type: 'Point', coordinates: [lngLat.lng, lngLat.lat].map(x => Math.round(x * 1000) / 1000)},\n    properties: {symbolzoom: Math.ceil(mapZoomLevel), name: value, labelId}\n  };\n  if (borderOwnerId !== undefined) {\n    label.properties.ownerId = borderOwnerId;\n  }\n  places.features.push(label);\n\n  indexedPlaces.set(labelId, label);\n  savePlaceLabels(places);\n  return places;\n}\n\nexport function editLabelInPlaces(labelId, places, value, lngLat, mapZoomLevel) {\n  if (!value) {\n    places.features = places.features.filter(f => f.properties.labelId !== labelId);\n    indexedPlaces.delete(labelId);\n  } else {\n    const labelToModify = places.features.find(f => f.properties.labelId === labelId);\n    labelToModify.properties.name = value;\n    labelToModify.properties.symbolzoom = Math.ceil(mapZoomLevel)\n    labelToModify.geometry.coordinates = [lngLat.lng, lngLat.lat].map(x => Math.round(x * 1000) / 1000);\n    indexedPlaces.set(labelId, labelToModify);\n  }\n\n  savePlaceLabels(places);\n  return places;\n}\n\nfunction mergePlacesWithLocalStorage() {\n  const savedPlaces = JSON.parse(localStorage.getItem('places')) || {type: \"FeatureCollection\", features: []};\n  let mergeIndex = new Map();\n  for (const savedPlace of savedPlaces.features) {\n    const placeKey = savedPlace.properties.labelId;\n    const place = mergeIndex.get(placeKey);\n    if (place) {\n      // local override:\n      mergeIndex.set(placeKey, Object.assign({}, place, savedPlace));\n    } else {\n      // local only:\n      mergeIndex.set(placeKey, savedPlace);\n    }\n  }\n\n  indexedPlaces.forEach((place, placeKey) => {\n    if (!mergeIndex.has(placeKey)) {\n      // remote only:\n      mergeIndex.set(placeKey, place);\n    }\n  });\n\n\n  return {\n    type: \"FeatureCollection\",\n    features: Array.from(mergeIndex.values())\n  };\n}\n\nfunction checkOriginalPlacesForChanges(mergedPlaces) {\n  if (!originalPlaces) return false;\n\n  for (const resolvedPlace of mergedPlaces.features) {\n    const placeKey = resolvedPlace.properties.labelId;\n    const place = indexedPlaces.get(placeKey);\n    if (!place) return true;\n    if (place.properties.name !== resolvedPlace.properties.name) return true;\n    if (place.properties.symbolzoom !== resolvedPlace.properties.symbolzoom) return true; \n    if (place.geometry.coordinates[0] !== resolvedPlace.geometry.coordinates[0]) return true;\n    if (place.geometry.coordinates[1] !== resolvedPlace.geometry.coordinates[1]) return true; \n  }\n\n  return false;\n}","\nexport default function createDOMarkerEditor(map, onSave, defaultText) {\n  const element = document.createElement('div');\n  element.className = 'label-marker';\n  element.innerHTML = `<form class=\"mini-label\">\n  <input type=\"text\" placeholder=\"Label\" />\n  <div class='commands'>\n    <a href='#' class=\"cancel\" tabindex=\"3\">Cancel</a>\n    <a href='#' class=\"accept\">Save</a>\n  </div>\n  </div>`;\n\n  if (defaultText) element.querySelector('input').value = defaultText;\n\n  let marker; \n  let startX = 0;\n  let startY = 0;\n  let dx = 0, dy = 0;\n\n  listenToEvents();\n\n  return {\n    element,\n    setMarker: (newMarker) => { marker = newMarker; },\n  }\n\n  function submit(e) {\n    e.preventDefault(); \n    onSave(element.querySelector('input').value);\n    close();\n  }\n\n  function listenToEvents() {\n    document.addEventListener('keydown', onKeyDown);\n    element.querySelector('form').addEventListener('submit', submit);\n    element.querySelector('.cancel').addEventListener('click', (e) => {\n      e.preventDefault();\n      close();\n    });\n\n    element.querySelector('.accept').addEventListener('click', (e) => {\n      submit(e);\n    });\n\n    element.addEventListener('pointerdown', (e) => {\n      startX = e.clientX; startY = e.clientY;\n      let markerCoordinates = map.project(marker.getLngLat());\n      dx = markerCoordinates.x - startX;\n      dy = markerCoordinates.y - startY;\n      window.addEventListener('pointermove', onPointerMove, true);\n      window.addEventListener('pointerup', cleanUp, true);\n    });\n  }\n\n  function onPointerMove(e) {\n    const newLngLat = map.unproject([e.clientX + dx, e.clientY + dy]);\n    marker.setLngLat(newLngLat);\n  }\n\n  function cleanUp() {\n    document.removeEventListener('keydown', onKeyDown);\n    window.removeEventListener('pointermove', onPointerMove, true);\n    window.removeEventListener('pointerup', cleanUp, true);\n  }\n\n  function close() {\n    marker.remove();\n    cleanUp();\n  }\n\n  function onKeyDown(e) {\n    if (e.key === 'Escape') {\n      close();\n      e.preventDefault();\n    }\n  }\n}","import maplibregl from 'maplibre-gl';\nimport {getPlaceLabels,  addLabelToPlaces, editLabelInPlaces} from './labelsStorage';\nimport createMarkerEditor from './createDOMMarkerEditor';\nimport bus from '../bus';\n\nexport default function createLabelEditor(map) {\n  let places;\n  const placeLabelLayers = ['place-country-1'];\n\n  getPlaceLabels().then(loadedPlaces => {\n    map.getSource('place').setData(loadedPlaces)\n    places = loadedPlaces;\n  });\n\n  return {\n    getContextMenuItems,\n    getPlaces: () => places\n  }\n\n  function getContextMenuItems(e, borderOwnerId) {\n    const labelFeature = map.queryRenderedFeatures(e.point, { layers: placeLabelLayers });\n    let items = []\n    if (labelFeature.length) {\n      const label = labelFeature[0].properties;\n      items.push({\n        text: `Edit ${label.name}`,\n        click: () => editLabel(labelFeature[0].geometry.coordinates, label)\n      });\n    } else {\n      items.push({\n        text: 'Add label',\n        click: () => addLabel(e.lngLat, borderOwnerId)\n      });\n    }\n\n    return items;\n  }\n\n  function addLabel(lngLat, borderOwnerId) {\n    const markerEditor = createMarkerEditor(map, save);\n\n    const marker = new maplibregl.Popup({closeButton: false});\n    marker.setDOMContent(markerEditor.element);\n    marker.setLngLat(lngLat);\n    marker.addTo(map);\n\n    markerEditor.setMarker(marker);\n\n    function save(value) {\n      if (!value) return;\n      places = addLabelToPlaces(places, value, marker.getLngLat(), map.getZoom(), borderOwnerId);\n      map.getSource('place').setData(places);\n      bus.fire('unsaved-changes-detected', true);\n    }\n  }\n\n  function editLabel(lngLat, oldLabelProps) {\n    const markerEditor = createMarkerEditor(map, save, oldLabelProps.name);\n\n    const marker = new maplibregl.Popup({closeButton: false});\n    marker.setDOMContent(markerEditor.element);\n    marker.setLngLat(lngLat);\n    marker.addTo(map);\n\n    markerEditor.setMarker(marker);\n\n    function save(value) {\n      places = editLabelInPlaces(oldLabelProps.labelId, places, value, marker.getLngLat(), map.getZoom());\n      map.getSource('place').setData(places);\n      bus.fire('unsaved-changes-detected', true);\n    }\n  }\n}","import \"maplibre-gl/dist/maplibre-gl.css\";\nimport maplibregl from \"maplibre-gl\";\nimport bus from \"./bus\";\nimport config from \"./config\";\nimport {getCustomLayer} from \"./gl/createLinesCollection.js\";\nimport downloadGroupGraph from \"./downloadGroupGraph.js\";\nimport getComplimentaryColor from \"./getComplimentaryColor\";\nimport createLabelEditor from \"./label-editor/createLabelEditor\";\nimport getColorTheme from \"./getColorTheme\";\n// import { createRadialGradient } from './gl/createRadialGradient';\n\nconst primaryHighlightColor = \"#bf2072\";\nconst secondaryHighlightColor = \"#e56aaa\";\n\nconst currentColorTheme = getColorTheme();\n\nconst colorStyle = [ \"case\" ]\ncurrentColorTheme.color.forEach((row) => {\n  colorStyle.push([\"==\", [\"get\", \"fill\"], row.input], row.output);\n})\ncolorStyle.push(\"#FF0000\");\n\nexport default function createMap() {\n  const map = new maplibregl.Map(getDefaultStyle());\n  map.dragRotate.disable();\n  map.touchZoomRotate.disableRotation();\n  const fastLinesLayer = getCustomLayer();\n  let backgroundEdgesFetch;\n  let labelEditor;\n  // collection of labels.\n\n  map.on(\"load\", () => {\n    map.addLayer(fastLinesLayer, \"circle-layer\");\n    // map.addLayer(createRadialGradient(), \"polygon-layer\");\n    labelEditor = createLabelEditor(map);\n  });\n\n  map.on(\"contextmenu\", (e) => {\n    bus.fire(\"show-tooltip\");\n    \n    let bg = getBackgroundNearPoint(e.point);\n    if (!bg) return;\n\n    const contextMenuItems = { \n      items: labelEditor.getContextMenuItems(e, bg.id),\n      left: e.point.x + \"px\", \n      top: e.point.y + \"px\" \n    };\n\n    contextMenuItems.items.push(showLargestProjectsContextMenuItem(bg));\n\n    const nearestCity = findNearestCity(e.point);\n    if (nearestCity) {\n      let name = nearestCity.properties.label;\n      let parts = name.split('/')\n      const displayName = parts[parts.length - 1] || name;\n\n      contextMenuItems.items.push({\n        text: \"List connections of \" + displayName,\n        click: () => {\n          showDetails(nearestCity);\n          drawBackgroundEdges(e.point, name);\n          bus.fire('focus-on-repo', name, bg.id);\n        }\n      });\n    }\n\n    bus.fire(\"show-context-menu\", contextMenuItems);\n  });\n\n  map.on(\"mousemove\", (e) => {\n    // let hoveredFeature = findNearestCity(e.point);\n    // if (hoveredFeature) {\n    //   const bgFeature = getBackgroundNearPoint(e.point);\n    //   bus.fire(\"show-tooltip\", { \n    //     text: hoveredFeature.properties.label, \n    //     left: e.point.x + \"px\",\n    //     top: e.point.y + \"px\",\n    //     background: bgFeature?.properties?.fill || \"rgba(0,0,0,0.5)\",\n    //   });\n    // } else {\n    //   bus.fire(\"show-tooltip\");\n    // }\n  });\n\n  map.on(\"click\", (e) => {\n    bus.fire(\"show-context-menu\");\n    const nearestCity = findNearestCity(e.point);\n    if (!nearestCity) return;\n    const repo = nearestCity.properties.label\n    if (!repo) return;\n    showDetails(nearestCity);\n\n    const includeExternal = e.originalEvent.altKey;\n    drawBackgroundEdges(e.point, repo, !includeExternal);\n  });\n  const bordersCollection = fetch(config.bordersSource).then((res) => res.json());\n\n  return {\n    map,\n    dispose() {\n      map.remove();\n      // TODO: Remove custom layer?\n    },\n    makeVisible,\n    clearHighlights,\n    clearBorderHighlights,\n    getPlacesGeoJSON,\n    getGroupIdAt\n  }\n\n  function getGroupIdAt(lat, lon) {\n    // find first group that contains the point.\n    return bordersCollection.then((collection) => {\n      const feature = collection.features.find((f) => {\n        return polygonContainsPoint(f.geometry.coordinates[0], lat, lon);\n      });\n      if (!feature) return;\n      const id = feature.id;\n      return id;\n    });\n\n    // const res = map.querySourceFeatures('borders-source').find((f) => {\n    //   return polygonContainsPoint(f.geometry.coordinates[0], lat, lon);\n    // });\n    // return res?.id;\n  }\n\n  function showDetails(nearestCity) {\n    const repo = nearestCity.properties.label\n    if (!repo) return;\n    const [lat, lon] = nearestCity.geometry.coordinates\n    bus.fire(\"show-tooltip\");\n    bus.fire(\"repo-selected\", { text: repo, lat, lon });\n  }\n\n  function showLargestProjectsContextMenuItem(bg) {\n    return {\n        text: \"Show largest projects\",\n        click: () => {\n          let seen = new Map();\n          let largeRepositories = map.querySourceFeatures(\"points-source\", {\n              sourceLayer: \"points\",\n              filter: [\"==\", \"parent\", bg.id]\n          }).sort((a, b) => {\n            return b.properties.size - a.properties.size;\n          });\n          for (let repo of largeRepositories) {\n            let v = {\n              name: repo.properties.label,\n              lngLat: repo.geometry.coordinates,\n            }\n            if (seen.has(repo.properties.label)) continue;\n            seen.set(repo.properties.label, v);\n            if (seen.size >= 100) break;\n          }\n          \n          map.setFilter(\"border-highlight\", [\"==\", [\"id\"], bg.id]);\n          map.setLayoutProperty(\"border-highlight\", \"visibility\", \"visible\");\n          // todo: fire a view model here instead of the list.\n          bus.fire(\"show-largest-in-group\", bg.id, Array.from(seen.values()));\n        }\n    }\n  }\n\n  function getPlacesGeoJSON() {\n    return labelEditor.getPlaces();\n  }\n\n  function clearBorderHighlights() {\n    map.setLayoutProperty(\"border-highlight\", \"visibility\", \"none\");\n  }\n\n  function clearHighlights() {\n    fastLinesLayer.clear();\n    map.getSource(\"selected-nodes\").setData({\n      type: \"FeatureCollection\",\n      features: []\n    });\n    map.redraw();\n  }\n\n  function makeVisible(repository, location, disableAnimation = false) {\n    if (disableAnimation) {\n      map.jumpTo(location);\n    } else {\n      map.flyTo(location)\n    }\n    map.once(\"moveend\", () => {\n      drawBackgroundEdges(location.center, repository);\n    });\n  }\n\n  function getBackgroundNearPoint(point) {\n    const borderFeature = map.queryRenderedFeatures(point, { layers: [\"polygon-layer\"] });\n    return borderFeature[0];\n  }\n\n  function drawBackgroundEdges(point, repo, ignoreExternal = true) {\n    const bgFeature = getBackgroundNearPoint(point);\n    if (!bgFeature) return;\n    const groupId = bgFeature.id;\n    if (groupId === undefined) return;\n\n    const fillColor = getPolygonFillColor(bgFeature.properties);\n    let complimentaryColor = getComplimentaryColor(fillColor);\n    fastLinesLayer.clear();\n    backgroundEdgesFetch?.cancel();\n    let isCancelled = false;\n    let highlightedNodes = {\n      type: \"FeatureCollection\",\n      features: []\n    };\n\n    backgroundEdgesFetch = downloadGroupGraph(groupId).then(groupGraph => {\n      if (isCancelled) return;\n      let firstLevelLinks = [];\n      let primaryNodePosition;\n      let renderedNodesAdjustment = new Map();\n      map.querySourceFeatures(\"points-source\", {\n        sourceLayer: \"points\",\n        filter: [\"==\", \"parent\", groupId]\n      }).forEach(repo => {\n        const lngLat = repo.geometry.coordinates;\n        renderedNodesAdjustment.set(repo.properties.label, {\n          lngLat\n        });\n      });\n\n      groupGraph.forEachLink(link => {\n        if (link.data?.e && ignoreExternal) return; // external;\n        const fromGeo = renderedNodesAdjustment.get(link.fromId)?.lngLat || groupGraph.getNode(link.fromId).data.l;\n        const toGeo = renderedNodesAdjustment.get(link.toId)?.lngLat || groupGraph.getNode(link.toId).data.l;\n\n        const from = maplibregl.MercatorCoordinate.fromLngLat(fromGeo);\n        const to = maplibregl.MercatorCoordinate.fromLngLat(toGeo);\n        const isFirstLevel = repo === link.fromId || repo === link.toId;\n        const line = {\n          from: [from.x, from.y],\n          to: [to.x, to.y],\n          color: isFirstLevel ? 0xffffffFF : complimentaryColor \n        }\n        // delay first level links to be drawn last, so that they are on the top\n        if (isFirstLevel) {\n          firstLevelLinks.push(line);\n\n          if (!primaryNodePosition) {\n            primaryNodePosition = repo === link.fromId ? fromGeo : toGeo;\n            highlightedNodes.features.push({\n              type: \"Feature\",\n              geometry: {type: \"Point\", coordinates: primaryNodePosition},\n              properties: {color: primaryHighlightColor, name: repo, background: fillColor, textSize: 1.2}\n            });\n          } \n          let otherName = repo === link.fromId ? link.toId : link.fromId;\n          // pick the other one too:\n          highlightedNodes.features.push({\n            type: \"Feature\",\n            geometry: {type: \"Point\", coordinates: repo === link.fromId ? toGeo : fromGeo},\n            properties: {color: secondaryHighlightColor, name: otherName, background: fillColor, textSize: 0.8}\n          });\n        } else fastLinesLayer.addLine(line);\n      });\n      firstLevelLinks.forEach(line => {\n        fastLinesLayer.addLine(line)\n      });\n      map.getSource(\"selected-nodes\").setData(highlightedNodes);\n      map.redraw();\n    });\n    backgroundEdgesFetch.cancel = () => {isCancelled = true};\n  }\n\n  function findNearestCity(point) {\n    let width = 16;\n    let height = 16;\n    const features = map.queryRenderedFeatures([\n      [point.x - width / 2, point.y - height / 2],\n      [point.x + width / 2, point.y + height / 2]\n    ], { layers: [\"circle-layer\"] });\n    if (!features.length) return;\n    let distance = Infinity;\n    let nearestCity = null;\n    features.forEach(feature => {\n      let geometry = feature.geometry.coordinates;\n      let dx = geometry[0] - point.x;\n      let dy = geometry[1] - point.y;\n      let d = dx * dx + dy * dy;\n      if (d < distance) {\n        distance = d;\n        nearestCity = feature;\n      }\n    });\n    return nearestCity;\n  }\n}\n\nfunction getDefaultStyle() {\n  return {\n    hash: true,\n    container: \"map\",\n    center: [0, 0],\n    zoom: 2,\n    style: {\n      version: 8,\n      glyphs: config.glyphsSource,\n      sources: {\n        \"borders-source\": { type: \"geojson\", data: config.bordersSource, },\n        \"points-source\": {\n          type: \"vector\",\n          tiles: [config.vectorTilesTiles],\n          minzoom: 4,\n          maxzoom: 7,\n          center: [-9.843750,4.213679,7],\n        },\n        \"place\": { // this one loaded asynchronously, and merged with local storage data\n          type: \"geojson\",\n          data: {\n            type: \"FeatureCollection\",\n            features: []\n          }\n        },\n        \"selected-nodes\": {\n          type: \"geojson\",\n          data: {\n            type: \"FeatureCollection\",\n            features: [] \n          }\n        }\n      },\n      layers: [\n        {\n        \"id\": \"background\",\n        \"type\": \"background\",\n        \"paint\": {\n          \"background-color\": currentColorTheme.background\n        }\n      },\n        {\n          \"id\": \"polygon-layer\",\n          \"type\": \"fill\",\n          \"source\": \"borders-source\",\n          \"filter\": [\"==\", \"$type\", \"Polygon\"],\n          \"paint\": {\n            \"fill-color\": colorStyle\n          }\n        },\n        {\n          \"id\": \"border-highlight\",\n          \"type\": \"line\",\n          \"source\": \"borders-source\",\n          \"layout\": {\n            \"visibility\": \"none\"\n          },\n          \"paint\": {\n            \"line-color\": \"#FFF\",\n            \"line-width\": 4,\n          }\n        },\n        {\n          \"id\": \"circle-layer\",\n          \"type\": \"circle\",\n          \"source\": \"points-source\",\n          \"source-layer\": \"points\",\n          \"filter\": [\"==\", \"$type\", \"Point\"],\n          \"paint\": {\n            \"circle-color\": currentColorTheme.circleColor,\n            \"circle-opacity\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              5, 0.1,\n              15, 0.9\n            ],\n            \"circle-stroke-color\": currentColorTheme.circleStrokeColor,\n            \"circle-stroke-width\": 1,\n            \"circle-stroke-opacity\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              8, 0.0,\n              15, 0.9\n            ],\n            \"circle-radius\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              5,  [\"*\", [\"get\", \"size\"], .1],\n              23, [\"*\", [\"get\", \"size\"], 1.5],\n            ]\n          }\n        },\n        {\n          \"id\": \"label-layer\",\n          \"type\": \"symbol\",\n          \"source\": \"points-source\",\n          \"source-layer\": \"points\",\n          \"filter\": [\">=\", [\"zoom\"], 8],\n          \"layout\": {\n            \"text-font\": [ \"Roboto Condensed Regular\" ],\n            \"text-field\": [\"slice\", [\"get\", \"label\"], [\"+\", [\"index-of\", \"/\", [\"get\", \"label\"]], 1]],\n            \"text-anchor\": \"top\",\n            \"text-max-width\": 10,\n            \"symbol-sort-key\": [\"-\", 0, [\"get\", \"size\"]],\n            \"symbol-spacing\": 500,\n            \"text-offset\": [0, 0.5],\n            \"text-size\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              8,  [\"/\", [\"get\", \"size\"], 4],\n              10, [\"+\", [\"get\", \"size\"], 8]\n            ],\n          },\n          \"paint\": {\n            \"text-color\": currentColorTheme.circleLabelsColor,\n            \"text-halo-color\": currentColorTheme.circleLabelsHaloColor,\n            \"text-halo-width\": currentColorTheme.circleLabelsHaloWidth,\n          },\n        }, \n        {\n          \"id\": \"selected-nodes-layer\",\n          \"type\": \"circle\",\n          \"source\": \"selected-nodes\",\n          \"paint\": {\n            \"circle-color\": [\"get\", \"color\"],\n          }\n        },\n        {\n          \"id\": \"selected-nodes-labels-layer\",\n          \"type\": \"symbol\",\n          \"source\": \"selected-nodes\",\n          \"layout\": {\n            \"text-font\": [ \"Roboto Condensed Regular\" ],\n            \"text-field\": [\"get\", \"name\"],\n            \"text-anchor\": \"top\",\n            \"text-max-width\": 10,\n            \"symbol-sort-key\": [\"-\", 0, [\"get\", \"textSize\"]],\n            \"symbol-spacing\": 500,\n            \"text-offset\": [0, 0.5],\n            \"text-size\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              8, [\"/\", [\"get\", \"size\"], 4],\n              10, [\"+\", [\"get\", \"size\"], 8]\n            ],\n          },\n          \"paint\": {\n            \"text-color\": \"#fff\",\n            \"text-halo-color\": [\"get\", \"color\"],\n            \"text-halo-width\": 2,\n          },\n        },\n        // TODO: move labels stuff to label editor?\n{\n    \"id\": \"place-country-1\",\n    // minzoom: 1, \n    \"maxzoom\": 10,\n    \"type\": \"symbol\",\n    \"source\": \"place\",\n    \"layout\": {\n        \"text-font\": [ \"Roboto Condensed Bold\" ],\n        \"text-size\": [\n          \"interpolate\",\n          [ \"cubic-bezier\", 0.2, 0, 0.7, 1 ],\n          [\"zoom\"],\n          1, [\n            \"step\",\n            [\"get\", \"symbolzoom\"], 15, \n            4, 13, \n            5, 12\n          ],\n          9, [\n            \"step\",\n            [\"get\", \"symbolzoom\"], 22,\n            4, 19,\n            5, 17\n          ]\n        ],\n        \"symbol-sort-key\": [\"get\", \"symbolzoom\"],\n        \"text-field\": \"{name}\",\n        \"text-max-width\": 6,\n        \"text-line-height\": 1.1,\n        \"text-letter-spacing\": 0,\n    },\n    \"paint\": {\n      \"text-color\": currentColorTheme.placeLabelsColor,\n      \"text-halo-color\": currentColorTheme.placeLabelsHaloColor,\n      \"text-halo-width\": currentColorTheme.placeLabelsHaloWidth,\n    },\n    \"filter\": [\n        \"<=\",\n        [\"get\", \"symbolzoom\"],\n        [\"+\", [\"zoom\"], 4]\n      ],\n},\n      ]\n    },\n  };\n}\n\nfunction getPolygonFillColor(polygonProperties) {\n  for (const color of currentColorTheme.color) {\n    if (color.input === polygonProperties.fill) {\n      return color.output;\n    }\n  }\n  return polygonProperties.fill;\n}\nfunction polygonContainsPoint(ring, pX, pY) {\n    let c = false;\n    for (let i = 0, j = ring.length - 1; i < ring.length; j = i++) {\n        const p1 = ring[i];\n        const p2 = ring[j];\n        if (((p1[1] > pY) !== (p2[1] > pY)) && (pX < (p2[0] - p1[0]) * (pY - p1[1]) / (p2[1] - p1[1]) + p1[0])) {\n            c = !c;\n        }\n    }\n    return c;\n}\n"],"names":["originalPlaces","indexedPlaces","getPlaceLabels","config","f","mergedLabels","mergePlacesWithLocalStorage","hasChanges","checkOriginalPlacesForChanges","bus","savePlaceLabels","places","addLabelToPlaces","value","lngLat","mapZoomLevel","borderOwnerId","labelId","generateShortRandomId","label","x","editLabelInPlaces","labelToModify","savedPlaces","mergeIndex","savedPlace","placeKey","place","mergedPlaces","resolvedPlace","createDOMarkerEditor","map","onSave","defaultText","element","marker","startX","startY","dx","dy","listenToEvents","newMarker","submit","e","close","onKeyDown","markerCoordinates","onPointerMove","cleanUp","newLngLat","createLabelEditor","placeLabelLayers","loadedPlaces","getContextMenuItems","labelFeature","items","editLabel","addLabel","markerEditor","createMarkerEditor","save","maplibregl","oldLabelProps","primaryHighlightColor","secondaryHighlightColor","currentColorTheme","getColorTheme","colorStyle","row","createMap","getDefaultStyle","fastLinesLayer","getCustomLayer","backgroundEdgesFetch","labelEditor","bg","getBackgroundNearPoint","contextMenuItems","showLargestProjectsContextMenuItem","nearestCity","findNearestCity","name","parts","displayName","showDetails","drawBackgroundEdges","repo","includeExternal","bordersCollection","res","makeVisible","clearHighlights","clearBorderHighlights","getPlacesGeoJSON","getGroupIdAt","lat","lon","collection","feature","polygonContainsPoint","seen","largeRepositories","b","v","repository","location","disableAnimation","point","ignoreExternal","bgFeature","groupId","fillColor","getPolygonFillColor","complimentaryColor","getComplimentaryColor","isCancelled","highlightedNodes","downloadGroupGraph","groupGraph","firstLevelLinks","primaryNodePosition","renderedNodesAdjustment","link","_a","fromGeo","_b","toGeo","_c","from","to","isFirstLevel","line","otherName","width","height","features","distance","geometry","d","polygonProperties","color","ring","pX","pY","c","i","j","p1","p2"],"mappings":"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"}